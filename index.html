<!DOCTYPE html>
<html lang="vi">
<head>
  <title>Cân Bằng Phương Trình Hóa Học - CuiBapVH</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="dashboard.css?28032019" rel="stylesheet" />
<div class="page-main">
				<div class="app-header1 header py-1 d-flex">
					<div class="container-fluid">
						<div class="d-flex">
							<a class="header-brand" href="#">
								<img src="logo.png?28032019" class="header-brand-img" alt="">
							</a>
</div></div></div></div>
</head>
<body>
	<div class="card">
		<div class="card-header">
			<h3 class="card-title">Cân Bằng PTHH</h3>
		</div>
		<form action="#" method="get" onsubmit="doBalance(); return false;">
		<div class=" card-body">
			<div class="d-flex">
				<div class="input-group wd-150">
					<input class="form-control" id="inputFormula" placeholder="H2 + O2 = H2O" type="text">
					</div>
			</div>
		</div>
		<div class="card-footer text-left">
			<button type="submit" class="btn btn btn-primary">Cân Bằng</button>	
			<button type="submit" class="btn btn btn-success" onclick="doRandom();">Ngẫu Nhiên</button>					
		</div>
		<div class="card-footer text-center">
			<span id="balanced" style="font-family:serif; font-size:150%; line-height:1.6;"></span>
			<span id="message"></span>
			<span id="codeOutput"></span>
		</div>
		</form>
	</div>
<script type="application/javascript">"use strict";var formulaElem=document.getElementById("inputFormula");function doBalance(){var a=document.getElementById("message");var f=document.getElementById("balanced");var c=document.getElementById("codeOutput");a.textContent="";while(f.firstChild!=null){f.removeChild(f.firstChild)}while(c.firstChild!=null){c.removeChild(c.firstChild)}c.textContent=" ";var g=formulaElem.value;var j;try{j=new Parser(g).parseEquation()}catch(h){if(typeof h=="string"){a.textContent="Lỗi cú pháp: "+h}else{if("start" in h){a.textContent="Lỗi cú pháp: "+h.message;var b=h.start;var d="end" in h?h.end:h.start;while(d>b&&[" ","\t"].indexOf(g.charAt(d-1))!=-1){d--}if(b==d){d++}c.textContent+=g.substr(0,b);if(d<=g.length){c.appendChild(createElem("u",g.substring(b,d)));c.appendChild(document.createTextNode(g.substring(d,g.length)))}else{c.appendChild(createElem("u"," "))}}else{a.textContent="Assertion error"}}return}try{var i=buildMatrix(j);solve(i);var k=extractCoefficients(i);checkAnswer(j,k);f.appendChild(j.toHtml(k))}catch(h){a.textContent=h.toString()}}function doDemo(a){formulaElem.value=a;doBalance()}var RANDOM_DEMOS=["H2 + O2 = H2O","Fe + O2 = Fe2O3","NH3 + O2 = N2 + H2O","C2H2 + O2 = CO2 + H2O","C3H8O + O2 = CO2 + H2O","Na + O2 = Na2O","P4 + O2 = P2O5","Na2O + H2O = NaOH","Mg + HCl = MgCl2 + H2","AgNO3 + LiOH = AgOH + LiNO3","Pb + PbO2 + H^+ + SO4^2- = PbSO4 + H2O","HNO3 + Cu = Cu(NO3)2 + H2O + NO","KNO2 + KNO3 + Cr2O3 = K2CrO4 + NO","AgNO3 + BaCl2 = Ba(NO3)2 + AgCl","Cu(NO3)2 = CuO + NO2 + O2","Al + CuSO4 = Al2(SO4)3 + Cu","Na3PO4 + Zn(NO3)2 = NaNO3 + Zn3(PO4)2","Cl2 + Ca(OH)2 = Ca(ClO)2 + CaCl2 + H2O","CHCl3 + O2 = CO2 + H2O + Cl2","H2C2O4 + MnO4^- = H2O + CO2 + MnO + OH^-","H2O2 + Cr2O7^2- = Cr^3+ + O2 + OH^-","KBr + KMnO4 + H2SO4 = Br2 + MnSO4 + K2SO4 + H2O","K2Cr2O7 + KI + H2SO4 = Cr2(SO4)3 + I2 + H2O + K2SO4","KClO3 + KBr + HCl = KCl + Br2 + H2O","Ag + HNO3 = AgNO3 + NO + H2O","P4 + OH^- + H2O = H2PO2^- + P2H4","Zn + NO3^- + H^+ = Zn^2+ + NH4^+ + H2O","ICl + H2O = Cl^- + IO3^- + I2 + H^+","AB2 + AC3 + AD5 + AE7 + AF11 + AG13 + AH17 + AI19 + AJ23 = A + ABCDEFGHIJ",];var lastRandomIndex=-1;function doRandom(){var a;do{a=Math.floor(Math.random()*RANDOM_DEMOS.length);a=Math.max(Math.min(a,RANDOM_DEMOS.length-1),0)}while(RANDOM_DEMOS.length>=2&&a==lastRandomIndex);lastRandomIndex=a;doDemo(RANDOM_DEMOS[a])}var Parser=(function(){function a(b){this.tok=new Tokenizer(b)}a.prototype.parseEquation=function(){var b=[this.parseTerm()];while(true){var c=this.tok.peek();if(c=="+"){this.tok.consume(c);b.push(this.parseTerm())}else{if(c=="="){this.tok.consume(c);break}else{throw {message:"Plus or equal sign expected",start:this.tok.pos}}}}var d=[this.parseTerm()];while(true){var c=this.tok.peek();if(c==null){break}else{if(c=="+"){this.tok.consume(c);d.push(this.parseTerm())}else{throw {message:"Plus or end expected",start:this.tok.pos}}}}return new Equation(b,d)};a.prototype.parseTerm=function(){var d=this.tok.pos;var c=[];var b=false;var f;while(true){f=this.tok.peek();if(f=="("){c.push(this.parseGroup())}else{if(f=="e"){this.tok.consume(f);b=true}else{if(f!=null&&/^[A-Z][a-z]*$/.test(f)){c.push(this.parseElement())}else{if(f!=null&&/^[0-9]+$/.test(f)){throw {message:"Invalid term - number not expected",start:this.tok.pos}}else{break}}}}}var e=null;if(f=="^"){this.tok.consume(f);f=this.tok.peek();if(f==null){throw {message:"Number or sign expected",start:this.tok.pos}}else{e=this.parseOptionalNumber();f=this.tok.peek()}if(f=="+"){e=+e}else{if(f=="-"){e=-e}else{throw {message:"Sign expected",start:this.tok.pos}}}this.tok.take()}if(b){if(c.length>0){throw {message:"Invalid term - electron needs to stand alone",start:d,end:this.tok.pos}}if(e==null){e=-1}if(e!=-1){throw {message:"Invalid term - invalid charge for electron",start:d,end:this.tok.pos}}}else{if(c.length==0){throw {message:"Invalid term - empty",start:d,end:this.tok.pos}}if(e==null){e=0}}return new Term(c,e)};a.prototype.parseGroup=function(){var c=this.tok.pos;this.tok.consume("(");var b=[];while(true){var d=this.tok.peek();if(d=="("){b.push(this.parseGroup())}else{if(d!=null&&/^[A-Z][a-z]*$/.test(d)){b.push(this.parseElement())}else{if(d==")"){this.tok.consume(d);if(b.length==0){throw {message:"Empty group",start:c,end:this.tok.pos}}break}else{throw {message:"Element, group, or closing parenthesis expected",start:this.tok.pos}}}}}return new Group(b,this.parseOptionalNumber())};a.prototype.parseElement=function(){var b=this.tok.take();if(!/^[A-Z][a-z]*$/.test(b)){throw"Assertion error"}return new ChemElem(b,this.parseOptionalNumber())};a.prototype.parseOptionalNumber=function(){var b=this.tok.peek();if(b!=null&&/^[0-9]+$/.test(b)){return checkedParseInt(this.tok.take())}else{return 1}};return a}());var Tokenizer=(function(){function a(b){this.str=b.replace(/\u2212/g,"-");this.pos=0;this.skipSpaces()}a.prototype.peek=function(){if(this.pos==this.str.length){return null}var b=/^([A-Za-z][a-z]*|[0-9]+|[+\-^=()])/.exec(this.str.substring(this.pos));if(b==null){throw {message:"Invalid symbol",start:this.pos}}return b[0]};a.prototype.take=function(){var b=this.peek();if(b==null){throw"Advancing beyond last token"}this.pos+=b.length;this.skipSpaces();return b};a.prototype.consume=function(b){if(this.take()!=b){throw"Token mismatch"}};a.prototype.skipSpaces=function(){var b=/^[ \t]*/.exec(this.str.substring(this.pos));if(b===null){throw"Assertion error"}this.pos+=b[0].length};return a}());var Equation=(function(){function a(b,c){this.leftSide=b.slice();this.rightSide=c.slice()}a.prototype.getElements=function(){var b=new Set();for(var e=0,c=this.leftSide.concat(this.rightSide);e<c.length;e++){var d=c[e];d.getElements(b)}return Array.from(b)};a.prototype.toHtml=function(b){if(b!==undefined&&b.length!=this.leftSide.length+this.rightSide.length){throw"Mismatched number of coefficients"}var e=document.createDocumentFragment();var c=0;function d(j){var h=true;for(var l=0,f=j;l<f.length;l++){var g=f[l];var k=b!==undefined?b[c]:1;if(k!=0){if(h){h=false}else{e.appendChild(createSpan("plus"," + "))}if(k!=1){var i=createSpan("coefficient",k.toString().replace(/-/,MINUS));if(k<0){i.classList.add("negative")}e.appendChild(i)}e.appendChild(g.toHtml())}c++}}d(this.leftSide);e.appendChild(createSpan("rightarrow"," \u2192 "));d(this.rightSide);return e};return a}());var Term=(function(){function a(b,c){if(b.length==0&&c!=-1){throw"Invalid term"}this.items=b.slice();this.charge=c}a.prototype.getElements=function(c){c.add("e");for(var e=0,b=this.items;e<b.length;e++){var d=b[e];d.getElements(c)}};a.prototype.countElement=function(b){if(b=="e"){return -this.charge}else{var d=0;for(var f=0,c=this.items;f<c.length;f++){var e=c[f];d=checkedAdd(d,e.countElement(b))}return d}};a.prototype.toHtml=function(){var e=createSpan("term");if(this.items.length==0&&this.charge==-1){e.textContent="e";e.appendChild(createElem("sup",MINUS))}else{for(var f=0,b=this.items;f<b.length;f++){var d=b[f];e.appendChild(d.toHtml())}if(this.charge!=0){var c=void 0;if(Math.abs(this.charge)==1){c=""}else{c=Math.abs(this.charge).toString()}if(this.charge>0){c+="+"}else{c+=MINUS}e.appendChild(createElem("sup",c))}}return e};return a}());var Group=(function(){function a(b,c){if(c<1){throw"Assertion error: Count must be a positive integer"}this.items=b.slice();this.count=c}a.prototype.getElements=function(c){for(var e=0,b=this.items;e<b.length;e++){var d=b[e];d.getElements(c)}};a.prototype.countElement=function(b){var d=0;for(var f=0,c=this.items;f<c.length;f++){var e=c[f];d=checkedAdd(d,checkedMultiply(e.countElement(b),this.count))}return d};a.prototype.toHtml=function(){var d=createSpan("group","(");for(var e=0,b=this.items;e<b.length;e++){var c=b[e];d.appendChild(c.toHtml())}d.appendChild(document.createTextNode(")"));if(this.count!=1){d.appendChild(createElem("sub",this.count.toString()))}return d};return a}());var ChemElem=(function(){function a(b,c){if(c<1){throw"Assertion error: Count must be a positive integer"}this.name=b;this.count=c}a.prototype.getElements=function(b){b.add(this.name)};a.prototype.countElement=function(b){return b==this.name?this.count:0};a.prototype.toHtml=function(){var b=createSpan("element",this.name);if(this.count!=1){b.appendChild(createElem("sub",this.count.toString()))}return b};return a}());var Matrix=(function(){function a(d,e){if(d<0||e<0){throw"Illegal argument"}this.numRows=d;this.numCols=e;var f=[];for(var b=0;b<e;b++){f.push(0)}this.cells=[];for(var c=0;c<d;c++){this.cells.push(f.slice())}}a.prototype.get=function(b,d){if(b<0||b>=this.numRows||d<0||d>=this.numCols){throw"Index out of bounds"}return this.cells[b][d]};a.prototype.set=function(b,e,d){if(b<0||b>=this.numRows||e<0||e>=this.numCols){throw"Index out of bounds"}this.cells[b][e]=d};a.prototype.swapRows=function(d,c){if(d<0||d>=this.numRows||c<0||c>=this.numRows){throw"Index out of bounds"}var b=this.cells[d];this.cells[d]=this.cells[c];this.cells[c]=b};a.addRows=function(b,e){var d=[];for(var c=0;c<b.length;c++){d.push(checkedAdd(b[c],e[c]))}return d};a.multiplyRow=function(b,d){return b.map(function(c){return checkedMultiply(c,d)})};a.gcdRow=function(c){var b=0;for(var e=0,d=c;e<d.length;e++){var f=d[e];b=gcd(f,b)}return b};a.simplifyRow=function(c){var d=0;for(var f=0,b=c;f<b.length;f++){var h=b[f];if(h!=0){d=Math.sign(h);break}}if(d==0){return c.slice()}var e=a.gcdRow(c)*d;return c.map(function(g){return g/e})};a.prototype.gaussJordanEliminate=function(){var e=this.cells=this.cells.map(a.simplifyRow);var d=0;for(var h=0;h<this.numCols;h++){var l=d;while(l<this.numRows&&e[l][h]==0){l++}if(l==this.numRows){continue}var b=e[l][h];this.swapRows(d,l);d++;for(var c=d;c<this.numRows;c++){var k=gcd(b,e[c][h]);e[c]=a.simplifyRow(a.addRows(a.multiplyRow(e[c],b/k),a.multiplyRow(e[h],-e[c][h]/k)))}}for(var h=this.numRows-1;h>=0;h--){var f=0;while(f<this.numCols&&e[h][f]==0){f++}if(f==this.numCols){continue}var b=e[h][f];for(var c=h-1;c>=0;c--){var k=gcd(b,e[c][f]);e[c]=a.simplifyRow(a.addRows(a.multiplyRow(e[c],b/k),a.multiplyRow(e[h],-e[c][f]/k)))}}};return a}());function buildMatrix(d){var c=d.getElements();var a=d.leftSide;var e=d.rightSide;var b=new Matrix(c.length+1,a.length+e.length+1);c.forEach(function(m,k){var f=0;for(var n=0,l=a;n<l.length;n++){var h=l[n];b.set(k,f,h.countElement(m));f++}for(var g=0,o=e;g<o.length;g++){var h=o[g];b.set(k,f,-h.countElement(m));f++}});return b}function solve(a){a.gaussJordanEliminate();function c(f){var e=0;for(var d=0;d<a.numCols;d++){if(a.get(f,d)!=0){e++}}return e}var b;for(b=0;b<a.numRows-1;b++){if(c(b)>1){break}}if(b==a.numRows-1){throw"Không thể cân bằng"}a.set(a.numRows-1,b,1);a.set(a.numRows-1,a.numCols-1,1);a.gaussJordanEliminate()}function extractCoefficients(b){var e=b.numRows;var h=b.numCols;if(h-1>e||b.get(h-2,h-2)==0){throw"Multiple independent solutions"}var g=1;for(var c=0;c<h-1;c++){g=checkedMultiply(g/gcd(g,b.get(c,c)),b.get(c,c))}var a=[];var f=true;for(var c=0;c<h-1;c++){var d=checkedMultiply(g/b.get(c,c),b.get(c,h-1));a.push(d);f=f&&d==0}if(f){throw"Không thể cân bằng"}return a}function checkAnswer(o,p){if(p.length!=o.leftSide.length+o.rightSide.length){throw"Assertion error: Mismatched length"}var q=true;for(var e=0,a=p;e<a.length;e++){var m=a[e];if(typeof m!="number"||isNaN(m)||Math.floor(m)!=m){throw"Assertion error: Not an integer"}q=q&&m==0}if(q){throw"Không thể cân bằng"}for(var n=0,l=o.getElements();n<l.length;n++){var b=l[n];var h=0;var d=0;for(var k=0,i=o.leftSide;k<i.length;k++){var c=i[k];h=checkedAdd(h,checkedMultiply(c.countElement(b),p[d]));d++}for(var g=0,f=o.rightSide;g<f.length;g++){var c=f[g];h=checkedAdd(h,checkedMultiply(c.countElement(b),-p[d]));d++}if(h!=0){throw"Assertion error: Incorrect balance"}}}var INT_MAX=9007199254740992;function checkedParseInt(b){var a=parseInt(b,10);if(isNaN(a)){throw"Not a number"}return checkOverflow(a)}function checkedAdd(a,b){return checkOverflow(a+b)}function checkedMultiply(a,b){return checkOverflow(a*b)}function checkOverflow(a){if(Math.abs(a)>=INT_MAX){throw"Arithmetic overflow"}return a}function gcd(a,c){if(typeof a!="number"||typeof c!="number"||isNaN(a)||isNaN(c)){throw"Invalid argument"}a=Math.abs(a);c=Math.abs(c);while(c!=0){var b=a%c;a=c;c=b}return a}var MINUS="\u2212";function createElem(b,c){var a=document.createElement(b);if(c!==undefined){a.textContent=c}return a}function createSpan(b,c){var a=createElem("span",c);a.className=b;return a}if(!("sign" in Math)){Math.sign=function(a){return a>0?1:(a<0?-1:0)}}if(!("from" in Array)){Array.from=function(b){var a=[];b.forEach(function(c){return a.push(c)});return a}};
</script>
</div>
</body>
			<footer class="footer">
				<div class="container">
					<div class="row align-items-center flex-row-reverse">
						<div class="col-lg-12 col-sm-12 mt-3 mt-lg-0 text-center">
							Copyright © 2019 by <a href="//fb.com/CuiBapVH.VN">CuiBapVH</a>
						</div>
					</div>
				</div>
			</footer>
</html>
